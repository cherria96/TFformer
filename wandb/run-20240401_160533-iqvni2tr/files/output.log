  | Name                       | Type                       | Params
--------------------------------------------------------------------------
0 | A_input_transformation     | Linear                     | 80
1 | X_input_transformation     | Linear                     | 16
2 | Y_input_transformation     | Linear                     | 32
3 | V_input_transformation     | Linear                     | 32
4 | self_positional_encoding_k | RelativePositionalEncoding | 248
5 | self_positional_encoding_v | RelativePositionalEncoding | 248
6 | transformer_blocks         | ModuleList                 | 8.2 K
7 | output_dropout             | Dropout                    | 0
--------------------------------------------------------------------------
8.4 K     Trainable params
0         Non-trainable params
8.4 K     Total params
0.033     Total estimated model params size (MB)
/home/user126/anaconda3/envs/dt_idl/lib/python3.11/site-packages/pytorch_lightning/trainer/connectors/data_connector.py:441: The 'train_dataloader' does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` to `num_workers=31` in the `DataLoader` to improve performance.
/home/user126/anaconda3/envs/dt_idl/lib/python3.11/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='none' instead.
  warnings.warn(warning.format(ret))












































Epoch 9:  78%|█████████████████████████████████████████████████████████████████████████████████████▎                        | 31/40 [00:09<00:02,  3.35it/s, v_num=i2tr]
`Trainer.fit` stopped: `max_epochs=10` reached.
Epoch 9: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 40/40 [00:14<00:00,  2.76it/s, v_num=i2tr]
Testing DataLoader 0:  75%|███████████████████████████████████████████████████████████████████████████████████▎                           | 3/4 [00:00<00:00, 14.12it/s]
/home/user126/TFformer/model/CT_ourmodel.py:345: UserWarning: Using a target size (torch.Size([256, 59, 1])) that is different to the input size (torch.Size([256, 59, 16])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  mse_loss = nn.functional.mse_loss(outcome_pred, batch['outputs'], reduce=False)
/home/user126/TFformer/model/CT_ourmodel.py:345: UserWarning: Using a target size (torch.Size([232, 59, 1])) that is different to the input size (torch.Size([232, 59, 16])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  mse_loss = nn.functional.mse_loss(outcome_pred, batch['outputs'], reduce=False)
INFO:model.CT_ourmodel:RMSE calculation for val.
INFO:model.CT_ourmodel:Predictions for val.
/home/user126/anaconda3/envs/dt_idl/lib/python3.11/site-packages/pytorch_lightning/trainer/connectors/data_connector.py:441: The 'predict_dataloader' does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` to `num_workers=31` in the `DataLoader` to improve performance.
INFO:__main__:Val normalised RMSE (all): 18.56958226923867; Val normalised RMSE (orig): 18.48602035399285
INFO:model.CT_ourmodel:RMSE calculation for test.
Testing DataLoader 0: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:00<00:00, 13.17it/s]
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   validation_mse_loss      0.9329005228428793
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Predicting DataLoader 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:00<00:00, 13.53it/s]


Predicting DataLoader 0:  89%|██████████████████████████████████████████████████████████████████████████████████████████████            | 79/89 [00:05<00:00, 14.14it/s]
INFO:__main__:Test normalised RMSE (all): 30.089360729895432; Test normalised RMSE (orig): 24.49020860004997; Test normalised RMSE (only counterfactual): 23.916363850420538
INFO:model.CT_ourmodel:RMSE calculation for val.
INFO:model.CT_ourmodel:Predictions for val.
INFO:__main__:Val normalised RMSE (all): 18.56958226923867; Val normalised RMSE (orig): 18.48602035399285
INFO:model.CT_ourmodel:RMSE calculation for test.
Predicting DataLoader 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 89/89 [00:06<00:00, 14.12it/s]
Predicting DataLoader 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:00<00:00, 13.52it/s]


Predicting DataLoader 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 89/89 [00:06<00:00, 14.18it/s]
{'encoder_val_rmse_all': 18.56958226923867, 'encoder_val_rmse_orig': 18.48602035399285, 'encoder_test_rmse_all': 30.089360729895432, 'encoder_test_rmse_orig': 24.49020860004997, 'encoder_test_rmse_last': 23.916363850420538}
INFO:__main__:Test normalised RMSE (all): 30.089360729895432; Test normalised RMSE (orig): 24.49020860004997; Test normalised RMSE (only counterfactual): 23.916363850420538